name: Smoke tests
on:
  workflow_call:
    inputs:
      environment:
        description: Environment
        type: string
        required: false
        default: 'dev'

permissions:
  contents: read
jobs:
  smoke_test:
    name: Run the smoke test
    runs-on: [self-hosted, hmpps-github-actions-runner]
    environment: ${{ inputs.environment }}
    steps:
      - uses: actions/checkout@v4
      # - name: Update credentials
      #   shell: bash
      #   run: wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo tee /etc/apt/trusted.gpg.d/google.asc >/dev/null
      # - name: Install curl
      #   run: sudo apt-get update && sudo apt-get install -y curl && sudo apt-get install -y jq
      - name: Run smoke tests in ${{ inputs.environment }}
        shell: bash
        run: |
          cd smoke_tests
          ./run-smoke-test.sh \
            --env ${{ inputs.environment }} \
            --lsj-secret ${{ secrets.APP_SMOKETEST_LSJSECRET }} \
            --msj-secret ${{ secrets.APP_SMOKETEST_MSJSECRET }} \
            --lsj-url https://send-legal-mail-${{ inputs.environment }}.prison.service.justice.gov.uk \
            --msj-url https://check-rule39-mail-${{ inputs.environment }}.prison.service.justice.gov.uk
      # - store_test_results:
      #     path: /tmp/slm-smoke-test-<< parameters.env >>/test_results
      # - store_artifacts:
      #     path: /tmp/slm-smoke-test-<< parameters.env >>/videos
      # - store_artifacts:
      #     path: /tmp/slm-smoke-test-<< parameters.env >>/screenshots
      # - store_artifacts:
      #     path: /tmp/slm-smoke-test-<< parameters.env >>/downloads
